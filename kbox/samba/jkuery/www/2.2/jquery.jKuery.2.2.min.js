(function(e){if(!e.fn.jquery||window.jKuery)return!1;var f={},h={},r={},c,p,f={dotDotDot:function(a){setInterval(function(){var b=e(a).text();e(a).text(3<b.length?b:b+".")},100);return!0},inquireJQuery:function(){return e.fn.jquery},getLib:function(){console.log("todo")},addSource:function(){console.log("todo")},listJSON:function(){r={};for(var a in h)r[a]={name:h[a].getName(),parms:h[a].getParms(),source:h[a].getSource(),query_type:h[a].getQtype(),method:h[a].getMethod()};return r},getJSONSkeleton:function(a){var b,
d;switch(a){case 1:b=d="rule";break;case 2:b=d="report";break;case 3:b="jkuery";d="rule";break;case 4:b="jkuery";d="report";break;case 6:b="jkuery";d="runrule";break;default:b="jkuery",d=d||"lookup"}return function(a,e,c,p,t){if(void 0==a)return f.listJSON();if(h[a])return h[a];if(h[a[0]])return h[a[0]];var l,m,g,k,q=0,n;n=function(a){switch(a){case "GET":case "PUT":case "POST":case "OPTIONS":case "DELETE":case "HEAD":k=a;break;case "CREATE":k="POST";break;case "READ":k="GET";break;case "UPDATE":k=
"PUT";break;case "DELETE":k="DELETE";break;default:k=k||"GET"}};l=/^.*[^\/]\/+[^\/].*$/;if(l.test(a))l=/^((http.?:)?\/\/[^\/]+|..)\/(jkuery|rule|runrule|report)\/([^\/]+)(?:\/|((?:\/[^\/?]+)+))(?:[?](.*))?$/,g=a.match(l),b=g[2],l=g[3],m=g[4].split("/").slice(1),d=g[5].match(/query_type=[^=]+/),n(e),n(c),g=k==e?!!c:!!e;else switch(l=a,arguments.length){case 0:throw Error("not enough arguments");default:for(q=1;q<arguments.length&&4!=q;q++)switch(typeof arguments[q]){case "string":n(arguments[q]);break;
case "boolean":g=arguments[q];break;case "object":m=arguments[q];break;default:throw Error("wrong datatype in arguments");}k=k||"GET";m=m||[];g=void 0==g?!1:!!g}n=f.hash(l,m,b,d,k);if(h[n])return g&&h[n].setRun(g).runAjax(),h[n];h[n]={};h[n]=new f.JSON(l,m,b,d,g,k);return h[n]}}};c=f.getJSONSkeleton(5);window.jKuery=c;c.fn=c.prototype={version:"2.2",constructor:c};c.fn.init=f.getJSONSkeleton(5);p={setFormat:function(a){this.format=a||this.format||1;return this},setTimeout:function(a){this.timeout=
a||this.timeout||1E4;return this},setDebug:function(a){this.debug=a&&/^(on|true|1)$/.test(a)?"true":"false";return this},setObj$:function(a){this.obj$=e(a);return this},setHost:function(a){this.host=a||this.host||window.location.origin;return this},clearInterval:function(){clearInterval(this.timer);return!0},updateObj$:function(a){e(a).html(this.getData());return this}};f.setget=function(a,b){var d;if("string"==typeof b){if(d=a+b.slice(0,1).toUpperCase()+b.slice(1),p[d])return p[d].apply(this,Array.prototype.slice.call(arguments,
2))}else if(b instanceof Array)for(d=0;d<b.length;d++)f.setget.call(this,a,b[d]);else e.error("Neither "+b.toString()+" nor "+d+" are avaialble");return!1};f.set=function(a){return f.setget.call(this,"set",a)};f.get=function(a){return f.setget.call(this,"get",a)};f.JSON=function(a,b,d,c,s,p){var r="new",t={},l,m,g={};d=d||"jkuery";s=!!s;p=p||"GET";c=c||"sqlp";l=f.hash(a,b,d,c,p);if(!h||!h[l])return e.error("You must instantiate this via a jKuery call"),!1;f.set.call(this,["format","host","timeout"]);
this.getParms=function(){return b};this.getQtype=function(){return c};this.getMethod=function(){return p};this.getSource=function(){return d};this.getState=function(){return r};this.getData=function(){return t};this.getName=function(){return a};this.setState=function(a){r=a;return this};this.setState(void 0);this.setRun=function(a){s=!!a;return this};this.setRun(s);this.runAjax=function(a){this.setAjax(a);return e.ajax(g)};this.setData=function(a){this.runAjax(a);return this};var k=function(a){var b=
this;b.setState("complete");1E3<m&&(b.setState("idle"),setTimeout(function(){s?b.runAjax.call(b,[a,function(){k.call(b,a)}]):k.call(b,a)},m))};this.setInterval=function(a,b){a=1E3<a||0==a?a:void 0;m=void 0!=a?a:m||9E5;k.call(this,b);return this};this.setAjax=function(a){e.extend(g,{context:this,url:this.buildAjaxURL(),data:{debug:this.debug,jautoformat:this.format,query_type:this.getQtype()},dataType:"json",type:this.getMethod(),timeout:this.timeout,beforeSend:function(){this.setState("refreshing")},
complete:[function(){this.setState("complete")}],success:[function(a){t=a}],error:[function(a,b,d){t={};e.extend(t,jQuery.parseJSON(a.responseText))}]});void 0!==a&&a instanceof Array?g.complete=g.complete.concat(a):"function"==typeof a&&g.complete.push(a);return g};s&&this.runAjax();return e.extend([l],this)};e.extend(!0,f.JSON.prototype,p,{buildAjaxURL:function(){var a,b,d;a=!this.getParms()instanceof Array?this.getParms().split():this.getParms();d=[this.getName()].concat(a);a=0;for(b=d.length;a<
b;a++)d[a]=encodeURI(d[a]);return this.host+"/"+this.getSource()+"/"+d[0]+"/"+d.slice(1,b).join("/")},analyzeConfig:function(){var a,b;b=["Name","parms"];for(a=0;a<b.length;a++)if(void 0===this[b[a]])throw Error("missing "+b[a]);},hasData:function(){return this.data.count&&0<this.data.count?!0:!1}});f.hash=function(){var a="",b=0,d,c,e;c=0;for(d=arguments.length;c<d;c++)a+=arguments[c].toString();d=a.length;if(0===d)return b;for(c=0;c<d;c++)e=a.charCodeAt(c),b=(b<<5)-b+e,b&=b;return"H"+b.toString()};
f.runRuleForP=function(a,b,d){return c(a,b,void 0==d?!0:d)};c.getJKVersion=function(){var a=f.runRuleForP("jKuery Version",[""],!1);a.setTimeout(1E3);return a};c.getSessionValue=function(a){var b="org_id user_id user_email user_name role_id platform org_name".split(" ");if(-1!=e.inArray(a,b))return f.runRuleForP("Session Value",[":"+a]);e.error("usage: getSessionValue('parmname')\n\nparmname: ("+b.join("|")+")")};c.runRuleForChange=function(a){var b=[c.getTicketId(),c.getLastTicketChangeId()];return f.runRuleForP(a,
b)};c.runRuleForTicket=function(a){return f.runRuleForP(a,[c.getTicketId])};c.runRuleForId=function(a,b){return f.runRuleForP(a,[b])};c.getPageVersion=function(){return 0<e('script[src*="BUILD"]').eq(0).length?e('script[src*="BUILD"]').eq(0).attr("src").match(/BUILD=([0-9]+)/)[1]:"unknown"};c.getKVersion=function(){var a=f.runRuleForP("K1000 Version",[]);a.setTimeout(1E3);return a};c.getLastTicketChangeId=function(){var a;e("#ticket_history_tbody").find('input[name^="fields\\[existing_change_owners_only\\]"').eq(0).each(function(){var b=
e(this).attr("name");a=b.substring(36,b.length-1)});if(0<parseInt(a))return parseInt(a)};c.getQueueId=function(){var a=e("#ticket_form").find('input[name="fields\\[queue_id\\]"]');if(0<a.length&&0<parseInt(a.val()))return parseInt(a.val())};c.getTicketId=function(){var a;if(0<e("#ticket_form").find('input[name="attr\\[ID\\]"]').length&&(a=e("#ticket_form").find('input[name="attr\\[ID\\]"]').val(),0<parseInt(a)))return parseInt(a);e.error("Current Page is not a ticket")};c.getPageURL=function(){return window.location.href.match(/([^/]*.php)/g)[0]?
window.location.href.match(/([^/]*.php)/g)[0]:"unknown"};c.getLocalizedPageName=function(){if(0<e("#pageName > h2").length)return e("#pageName > h2").text()};c.runRuleForID=function(a){c.getQueueId()};c.getLastJSON=function(){return h};e.extend(!0,c,{Lib:function(){this.sources={aboutjKuery:{method:"aboutjKuery",source:"jkuery/www/other/js/jquery.aboutjKuery.js",element:"#aboutLink",parms:{style:{"font-style":"bold",color:"red","font-size":"1.2em"}}}}}});e.extend(c.Lib.prototype,{Init:function(){console.log("todo")}})})(window.jQuery);
